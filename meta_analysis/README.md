# Meta Analysis Building Block

This package provides the Meta Analysis **Building Block (BB)**.

## Table of Contents

- [Meta Analysis Building Block](#meta-analysis-building-block)
  - [Table of Contents](#table-of-contents)
  - [Description](#description)
  - [User instructions](#user-instructions)
    - [Requirements](#requirements)
    - [Installation](#installation)
    - [Usage](#usage)
    - [Uninstall](#uninstall)
  - [Contact](#contact)

## Description

This BB is designed to analyse the set of simulations generated for each individual in order to assess whether any of the parameters of interest show a differential distribution between the phenotypic subgroups included in the sample. To do so, this BB processes the output generated by the patient-personalized PhysiBoSS runs, including for each individual a given number of replicates of both wild-type and mutant experiments. With this information, this BB can assess the degree of uncertainty for each parameter and determine whether there are significant differences between the different subgroups, described both graphically and numerically.


## User instructions

### Requirements

- Python >= 3.6
- [Singularity](https://singularity.lbl.gov/docs-installation)
- `permedcoe` base package: `python3 -m pip install permedcoe`

In addtion to the dependencies, it is necessary to generate the associated
singularity image ([`meta_analysis.singularity`](../Resources/images/meta_analysis.singularity)),
located in the **Resources** folder of this repository.

They **MUST be available and exported in the following environment variable**
before its usage:

```bash
export PERMEDCOE_IMAGES="/path/to/images/"
```

### Installation

This package provides an automatic installation script:

```bash
./install.sh
```

### Usage

The `meta_analysis` package provides a clear interface that allows
it to be used with multiple workflow managers (e.g. PyCOMPSs, NextFlow and
Snakemake).

It can be imported from python and invoked directly from a **PyCOMPSs**
application, or through the command line for other workflow managers
(e.g. Snakemake and NextFlow).

The command line is:

```bash
META_ANALISIS_ASSETS=$(python3 -c "import meta_analysis_BB; import os; print(os.path.dirname(meta_analysis_BB.__file__))")

meta_analysis_BB -d \
    -i <meta_file> <out_dir> <model_prefix> <ko_file> <reps> <verbose> \
    -o <result_folder> \
    --mount_point ${META_ANALISIS_ASSETS}/assets:${META_ANALISIS_ASSETS}/assets
```

Where the parameters are:

|        | Parameter          | Type      | Description                                             |
|--------|--------------------|-----------|---------------------------------------------------------|
| Input  | \<meta_file>       | File      | Sample information                                      |
| Input  | \<out_dir>         | Directory | Simulations output folder                               |
| Input  | \<model_prefix>    | String    | Prefix of the boolean model used in the simulations     |
| Input  | \<ko_file>         | File      | Evaluated gene KOs                                      |
| Input  | \<reps>            | Int       | Number of replicas                                      |
| Input  | \<verbose>         | String    | Verbose level                                           |
| Output | \<result_folder>   | Directory | Output folder                                           |

### Uninstall

Uninstall can be achieved by executing the following scripts:

```bash
./uninstall.sh
./clean.sh
```

## Contact

<https://permedcoe.eu/contact/>
